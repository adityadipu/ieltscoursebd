<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Listening Mastery</title>
    <!-- SECURITY CHECK -->
    <script>
        // Simulating login check for this standalone file
        // In a real app, keep the original check
        if(localStorage.getItem('isLoggedIn') !== 'true') {
            // window.location.href = 'login.html'; 
            console.log("Login check skipped for demo purposes.");
        }
    </script>
    <style>
        /* --- VARIABLES & RESET --- */
        :root {
            --primary: #be123c;    /* Rose Red for IELTS */
            --secondary: #881337;
            --accent: #fb7185;
            --bg: #fff1f2;
            --card-bg: #ffffff;
            --text: #374151;
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding-bottom: 50px; }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .home-link {
            position: absolute; top: 20px; left: 20px;
            color: rgba(255,255,255,0.9); text-decoration: none; font-weight: bold;
        }
        .home-link:hover { text-decoration: underline; }

        h1 { font-size: 2.2rem; margin-bottom: 0.5rem; }
        .subtitle { font-size: 1rem; opacity: 0.9; }

        /* --- LAYOUT --- */
        .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }

        /* --- TABS --- */
        .tabs { display: flex; gap: 10px; margin: -25px auto 30px; justify-content: center; flex-wrap: wrap; position: relative; z-index: 10; }
        .tab-btn {
            padding: 12px 25px;
            background: white;
            border: none;
            border-radius: 30px;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            flex: 1;
            min-width: 140px;
            max-width: 200px;
            text-align: center;
        }
        .tab-btn.active { background: var(--primary); color: white; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(190, 18, 60, 0.3); }

        /* --- SECTIONS --- */
        .section-content { display: none; animation: fadeIn 0.4s ease; }
        .section-content.active { display: block; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        h2 { color: var(--primary); border-bottom: 2px solid #ffe4e6; padding-bottom: 10px; margin-bottom: 20px; }
        h3 { color: var(--secondary); margin: 20px 0 10px; font-size: 1.1rem; }

        /* --- 1. OVERVIEW GRID --- */
        .parts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .part-card { 
            background: #fff0f1; border: 1px solid #fda4af; padding: 15px; border-radius: 10px; text-align: center; transition: 0.3s;
        }
        .part-card:hover { transform: translateY(-5px); background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .part-icon { font-size: 2rem; display: block; margin-bottom: 10px; }
        .part-title { font-weight: bold; color: var(--primary); display: block; margin-bottom: 5px; }
        .part-desc { font-size: 0.9rem; color: #666; }
        .speaker-count { background: #fee2e2; color: #881337; font-size: 0.8rem; padding: 2px 8px; border-radius: 10px; font-weight: bold; margin-top: 5px; display: inline-block; }

        /* --- 2. PREPOSITION JUDGE --- */
        .judge-box { background: #f0fdf4; border: 2px dashed #22c55e; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .judge-input { padding: 10px; width: 70%; border: 1px solid #ccc; border-radius: 5px; margin-top: 10px; font-size: 1rem; }
        .judge-btn { padding: 10px 20px; background: #22c55e; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 5px; }
        .judge-result { margin-top: 15px; font-weight: bold; min-height: 20px; }
        
        /* New Preposition Game Styles */
        .prep-game-box { background: #ecfdf5; border-left: 5px solid #059669; padding: 20px; border-radius: 8px; margin-top: 15px; }
        .prep-option-btn { flex: 1; padding: 12px; background: white; border: 2px solid #6ee7b7; color: #047857; font-weight: bold; cursor: pointer; border-radius: 6px; transition: 0.2s; }
        .prep-option-btn:hover { background: #d1fae5; }
        
        .rule-note { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 10px; margin: 10px 0; font-size: 0.9rem; }
        .example-list { list-style: none; padding: 0; }
        .example-list li { margin-bottom: 5px; padding-left: 15px; border-left: 3px solid var(--accent); }

        /* --- 3. STRATEGY STEPPER --- */
        .step-container { display: flex; flex-direction: column; gap: 15px; }
        .step-item { background: #f8fafc; border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; display: flex; align-items: start; gap: 15px; }
        .step-num { background: var(--primary); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        
        /* Prediction Tool */
        .prediction-tool { background: #eff6ff; border: 2px solid #3b82f6; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center; }
        .pred-options button { margin: 5px; padding: 8px 15px; background: white; border: 1px solid #3b82f6; color: #3b82f6; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .pred-options button:hover { background: #3b82f6; color: white; }

        /* Note Taking Matcher */
        .note-game { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .note-item { background: white; padding: 10px; border: 1px solid #ddd; text-align: center; cursor: pointer; border-radius: 5px; }
        .note-item.matched { background: #dcfce7; border-color: #10b981; color: #10b981; pointer-events: none; }

        /* --- 4. TRAP DETECTOR --- */
        .trap-box { background: #fff7ed; border-left: 5px solid #f97316; padding: 20px; margin-bottom: 20px; border-radius: 8px; transition: all 0.3s ease; }
        .audio-script { font-family: 'Courier New', monospace; background: #fff; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px solid #eee; color: #444; }
        .trap-options { display: flex; gap: 10px; }
        .trap-btn { flex: 1; padding: 10px; background: white; border: 2px solid #fdba74; color: #c2410c; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .trap-btn:hover { background: #ffedd5; }
        
        /* Shared Next Button */
        .next-btn {
            background: #fff; 
            border: 1px solid currentColor; 
            margin-top: 15px; 
            font-size: 0.85rem; 
            padding: 6px 15px; 
            border-radius: 20px; 
            cursor: pointer; 
            display: inline-block;
        }
        .next-btn:hover { opacity: 0.8; }

        .check-list li { list-style: none; padding-left: 25px; position: relative; margin-bottom: 10px; }
        .check-list li::before { content: '‚úÖ'; position: absolute; left: 0; }
        .danger-list li { list-style: none; padding-left: 25px; position: relative; margin-bottom: 10px; }
        .danger-list li::before { content: '‚ö†Ô∏è'; position: absolute; left: 0; }

        /* New Matcher for Exact Words */
        .exact-box { background: #fdf2f8; border-left: 5px solid #db2777; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .exact-btn { flex: 1; padding: 10px; background: white; border: 2px solid #f9a8d4; color: #be185d; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .exact-btn:hover { background: #fce7f3; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header>
        <a href="#" class="home-link">IELTS</a>
        <h1>IELTS Listening Mastery</h1>
        <p class="subtitle">Strategies, Traps & Rules from the Official Guide</p>
    </header>

    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(this, 'overview')">1. Structure</button>
            <button class="tab-btn" onclick="switchTab(this, 'rules')">2. Rules & Prepositions</button>
            <button class="tab-btn" onclick="switchTab(this, 'strategy')">3. Smart Strategies</button>
            <button class="tab-btn" onclick="switchTab(this, 'traps')">4. Traps & Tips</button>
        </div>

        <!-- TAB 1: OVERVIEW -->
        <div id="overview" class="section-content active">
            <div class="card">
                <h2>The 40-Minute Breakdown</h2>
                <div style="display:flex; justify-content:space-around; text-align:center; margin-bottom:30px; font-weight:bold; color:#444;">
                    <div>üéß 30 Minutes<br><span style="font-size:0.9rem; font-weight:normal;">Listening</span></div>
                    <div style="font-size:1.5rem;">+</div>
                    <div>üìù 2-10 Minutes<br><span style="font-size:0.9rem; font-weight:normal;">Check/Transfer</span></div>
                    <div style="font-size:1.5rem;">=</div>
                    <div>üèÜ 40 Questions<br><span style="font-size:0.9rem; font-weight:normal;">1 Mark Each</span></div>
                </div>

                <h3>The 4 Sections</h3>
                <div class="parts-grid">
                    <div class="part-card">
                        <span class="part-icon">‚òï</span>
                        <span class="part-title">Part 1</span>
                        <span class="speaker-count">2 Speakers</span>
                        <div class="part-desc" style="margin-top:5px;">Everyday Conversation<br><em>Ex: Booking a hotel, Travel plans, Asking for info, Restaurant booking, Meeting someone.</em></div>
                    </div>
                    <div class="part-card">
                        <span class="part-icon">üé§</span>
                        <span class="part-title">Part 2</span>
                        <span class="speaker-count">1 Speaker</span>
                        <div class="part-desc" style="margin-top:5px;">Everyday Monologue<br><em>Ex: Speech about local facilities, Tour guide explaining resort/history, Charity talk.</em></div>
                    </div>
                    <div class="part-card">
                        <span class="part-icon">üéì</span>
                        <span class="part-title">Part 3</span>
                        <span class="speaker-count">2-4 Speakers</span>
                        <div class="part-desc" style="margin-top:5px;">Education / Training<br><em>Ex: University students discussing an assignment with a teacher.</em></div>
                    </div>
                    <div class="part-card">
                        <span class="part-icon">üèõÔ∏è</span>
                        <span class="part-title">Part 4</span>
                        <span class="speaker-count">1 Speaker</span>
                        <div class="part-desc" style="margin-top:5px;">Academic Lecture<br><em>Ex: Lecture on Science, History, Education.</em></div>
                    </div>
                </div>

                <h3>Question Types Gallery</h3>
                <div class="parts-grid">
                    <div class="part-card" style="background:#fff;">
                        <span class="part-title">Multiple Choice</span>
                        <div class="part-desc">Choose 1 (A,B,C) or Choose multiple from list. Focus on Main Ideas/Specific Details.</div>
                    </div>
                    <div class="part-card" style="background:#fff;">
                        <span class="part-title">Map/Plan/Diagram</span>
                        <div class="part-desc">Label a Map, Building Plan, Diagram, or Street. Follow directions (North, South).</div>
                    </div>
                    <div class="part-card" style="background:#fff;">
                        <span class="part-title">Completion Tasks</span>
                        <div class="part-desc">Form, Note, Flow-Chart, Table, Sentence, Summary Completion. Fill in missing info.</div>
                    </div>
                    <div class="part-card" style="background:#fff;">
                        <span class="part-title">Short Answer</span>
                        <div class="part-desc">Write a short answer (Facts: Time, Place, Number). Sometimes give 2/3 answers.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: RULES & PREPOSITIONS -->
        <div id="rules" class="section-content">
            <div class="card">
                <h2>üìè Word Counts & Limits</h2>
                <div class="rule-note">
                    <strong>Golden Rule:</strong> "No more than TWO words and/or A NUMBER".
                </div>
                <ul class="check-list">
                    <li><strong>All words count:</strong> Articles (a, an, the) are words!</li>
                    <li>the library = <strong>2 words</strong></li>
                    <li>the main library = <strong>3 words</strong></li>
                    <li>the main city library = ‚ùå <strong>4 words</strong> (Too many!)</li>
                    <li>a holiday = <strong>1 word</strong> (a is an article)</li>
                    <li>1950 = <strong>1 word</strong> (Number)</li>
                    <li>Part-time = <strong>1 word</strong> (Hyphenated)</li>
                    <li>Part-time job = <strong>2 words</strong></li>
                </ul>

                <h3>Should we write a Preposition?</h3>
                <p><strong>Example Question:</strong> PLACE: (2) HOSPITAL</p>
                <div style="background:#fff; border:1px solid #ddd; padding:15px; border-radius:8px;">
                    <p>‚ùå <em>"at the hospital"</em> (3 words) - <strong>WRONG</strong> if limit is 2 words.</p>
                    <p>‚úÖ <em>"the hospital"</em> (2 words) - <strong>CORRECT</strong>.</p>
                    <p><em>The best place to meet is AT THE HOSPITAL.</em></p>
                </div>

                <!-- PREPOSITION GAME SECTION -->
                <div class="prep-game-box">
                    <h3 style="color:#047857; margin-top:0;">üéÆ Preposition Master</h3>
                    <p style="font-size:0.9rem; color:#065f46;">Read the Question requirement and decide the best answer based on the Audio.</p>
                    
                    <div class="audio-script" style="border-left:4px solid #10b981; margin-top:10px;">
                        <span id="prep-audio"><strong>Audio:</strong> "We usually meet on Monday."</span>
                    </div>

                    <p style="margin-bottom:10px; font-weight:bold;" id="prep-q">Question: Day: _______ (No more than 1 word)</p>

                    <div class="trap-options">
                        <button class="prep-option-btn" onclick="checkPrep(0)" id="prep-btn-0">on Monday</button>
                        <button class="prep-option-btn" onclick="checkPrep(1)" id="prep-btn-1">Monday</button>
                    </div>
                    <div id="prep-msg" style="margin-top:10px; font-weight:bold;"></div>

                    <button class="next-btn" style="color:#059669; border-color:#059669;" onclick="nextPrep()">Next Example ‚û°</button>
                </div>

                <h3>Formatting Tips</h3>
                <ul class="check-list">
                    <li><strong>Forms/Notes/Tables:</strong> Use short key words.</li>
                    <li><strong>Sentence Completion:</strong> Must be a complete, grammatical phrase.</li>
                    <li><strong>Spelling:</strong> Incorrect spelling = 0 Marks.</li>
                    <li><strong>Capitalization:</strong> "GARDEN" or "Garden" are both accepted.</li>
                </ul>
                
                <h3>Interactive Judge</h3>
                <p style="font-size:0.9rem; color:#666;">Test your answer against a "2 Word Limit".</p>
                <div class="judge-box">
                    <label>Type your answer:</label><br>
                    <input type="text" id="wordInput" class="judge-input" placeholder="e.g. at the hospital">
                    <button class="judge-btn" onclick="checkWordCount()">Judge Me</button>
                    <div id="judgeResult" class="judge-result"></div>
                </div>
            </div>
        </div>

        <!-- TAB 3: STRATEGIES -->
        <div id="strategy" class="section-content">
            <div class="card">
                <h2>üöÄ Preparation Phase (Before Audio)</h2>
                <div class="step-container">
                    <div class="step-item">
                        <span class="step-num">1</span>
                        <div>
                            <strong>Look for Titles</strong><br>
                            Read the title (e.g., "Diagram Completion", "Map") and underline it. It gives context.
                        </div>
                    </div>
                    <div class="step-item">
                        <span class="step-num">2</span>
                        <div>
                            <strong>Check the Range</strong><br>
                            When told "Prepare for questions 1 to 7", ONLY look at 1-7. Don't waste time on others.
                        </div>
                    </div>
                    <div class="step-item">
                        <span class="step-num">3</span>
                        <div>
                            <strong>Predict the Answer Type</strong><br>
                            Guess if the blank needs a Number, a Name, a Place, or a Time.
                        </div>
                    </div>
                </div>

                <div class="prediction-tool">
                    <h3>üîÆ Prediction Practice</h3>
                    <p id="pred-q">"Meeting time: _______"</p>
                    <div class="pred-options">
                        <button onclick="checkPred('Number/Time')">Number/Time</button>
                        <button onclick="checkPred('Place')">Place</button>
                        <button onclick="checkPred('Name')">Person's Name</button>
                    </div>
                    <div id="pred-feedback" style="margin-top:10px; font-weight:bold; height:20px;"></div>
                </div>

                <h3>üîÑ Paraphrasing (The Key!)</h3>
                <p>IELTS rarely uses the exact words. They use synonyms.</p>
                <div style="background:#f0f9ff; border-left:4px solid #3b82f6; padding:15px; margin-bottom:20px;">
                    <strong>Question:</strong> "The town square was built by SOMEONE..."<br>
                    <strong>Audio might say:</strong> "...Constructed by..." OR "...Developed by..." OR "...Created by..."<br>
                    <br>
                    <em>Note: Technical and Academic language is usually NOT paraphrased.</em>
                </div>

                <h3>‚úçÔ∏è While Listening</h3>
                <ul class="danger-list">
                    <li><strong>Order:</strong> Answers follow the same order as the audio.</li>
                    <li><strong>Gaps:</strong> Sometimes answers come quickly, sometimes there is a gap.</li>
                    <li><strong>Gap Strategy:</strong> Listening -> Waiting -> Waiting -> No answer -> Nervous? -> Underline keyword -> Make note -> Move on!</li>
                </ul>

                <h3>üìù Note Taking Game</h3>
                <p>Don't write full words if you are in a hurry. Use short versions!</p>
                <div class="note-game" id="noteGame">
                    <!-- Injected via JS -->
                </div>
                <div id="note-msg" style="text-align:center; margin-top:10px; font-weight:bold; color:var(--success);"></div>
            </div>
        </div>

        <!-- TAB 4: TRAPS & TIPS -->
        <div id="traps" class="section-content">
            <div class="card">
                <h2>‚ö†Ô∏è Trap Detector</h2>
                
                <div class="rule-note" style="border-left-color: #ef4444; background: #fef2f2;">
                    <strong>The "Same Word" Trap:</strong> If you hear the <em>exact same word</em> as in the question -> Be careful! It's likely a trap. IELTS usually uses paraphrasing for the correct answer.
                </div>

                <div class="rule-note" style="border-left-color: #f59e0b; background: #fffbeb;">
                    <strong>The "Correction" Trap:</strong> The speaker says something, then changes their mind.
                </div>
                
                <!-- DYNAMIC TRAP BOX -->
                <div class="trap-box">
                    <p style="font-size:0.9rem; color:#c2410c; margin-bottom:10px;">üéß Listen for the change of mind:</p>
                    <div class="audio-script">
                        <span id="trap-audio"><strong>Audio:</strong> "Shall we meet at 7 o'clock? ... Oh sorry! How about half past seven?"</span>
                    </div>
                    <p style="margin-bottom:10px; font-weight:bold;" id="trap-q">Question: Meeting time?</p>
                    <div class="trap-options">
                        <button class="trap-btn" onclick="checkTrapDynamic(0)" id="trap-btn-0">7:00</button>
                        <button class="trap-btn" onclick="checkTrapDynamic(1)" id="trap-btn-1">7:30</button>
                    </div>
                    <div id="trap-msg" style="margin-top:10px; font-weight:bold;"></div>
                    
                    <button class="next-btn" style="color:#c2410c; border-color:#c2410c;" onclick="nextTrap()">Next Trap Example ‚û°</button>
                </div>

                <!-- NEW SECTION: EXACT WORD MATCHER -->
                <div class="exact-box">
                    <h3 style="color:#be185d; margin-top:0;">‚úçÔ∏è Write What You Hear</h3>
                    <p style="color:#831843; font-size:0.9rem;">Don't change the word form unless necessary. Fit the grammar of the gap.</p>
                    
                    <div class="audio-script" style="border-left:4px solid #db2777;">
                        <span id="exact-audio"><strong>Audio:</strong> "Children must be accompanied by an adult at all times."</span>
                    </div>
                    
                    <p style="margin-bottom:10px; font-weight:bold;" id="exact-q">Question: "No children are allowed without _______."</p>
                    
                    <div class="trap-options">
                        <button class="exact-btn" onclick="checkExact(0)" id="exact-btn-0">an accompanied adult</button>
                        <button class="exact-btn" onclick="checkExact(1)" id="exact-btn-1">an adult</button>
                    </div>
                    <div id="exact-msg" style="margin-top:10px; font-weight:bold;"></div>
                    
                    <button class="next-btn" style="color:#be185d; border-color:#be185d;" onclick="nextExact()">Next Example ‚û°</button>
                </div>

                <h3 style="margin-top:30px;">üîÑ Repeated Answers / Self-Correction Cues</h3>
                <p>Listen for these phrases. The <strong>real answer</strong> usually comes AFTER them:</p>
                <ul class="check-list">
                    <li>"Is that what you mean? Did you mean this?"</li>
                    <li>"Do you mean...?"</li>
                    <li>"So that's...?"</li>
                    <li>"Let me check..."</li>
                </ul>

                <h3>üí° Final Tips</h3>
                <ul class="danger-list">
                    <li><strong>Don't try to understand everything!</strong> Aim for the specific answer.</li>
                    <li><strong>Plurals:</strong> "Student" ‚ùå vs "Students" ‚úÖ. Listen for the 'S'.</li>
                    <li><strong>No Negative Marking:</strong> If you don't know, GUESS!</li>
                    <li><strong>Check Headphones:</strong> Ensure they work before the test starts.</li>
                </ul>
            </div>
        </div>

    </div>

    <script>
        // --- TAB SWITCHING ---
        function switchTab(btnElement, tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.section-content').forEach(content => content.classList.remove('active'));
            btnElement.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // --- WORD COUNT JUDGE (Tab 2) ---
        function checkWordCount() {
            const input = document.getElementById('wordInput').value.trim();
            const resultDiv = document.getElementById('judgeResult');
            
            if(!input) {
                resultDiv.innerHTML = "Please type something first.";
                return;
            }

            const words = input.split(/\s+/).filter(w => w.length > 0);
            let count = words.length;
            
            let color = "#10b981"; 
            let msg = `${count} word(s). `;

            if (count > 2) {
                color = "#ef4444"; 
                msg += `‚ö†Ô∏è Too many for "2 word limit"! (Articles 'a/an/the' count!)`;
            } else {
                msg += "‚úÖ Safe for " + '"No more than 2 words".';
            }

            if (input.toLowerCase().includes('at the')) {
                msg += "<br>‚ö†Ô∏è Warning: Prepositions like 'at' count as words! You might exceed the limit.";
            }

            resultDiv.innerHTML = `<span style="color:${color}">${msg}</span>`;
        }

        // --- PREPOSITION MASTER GAME (Tab 2) ---
        const prepScenarios = [
            {
                audio: "We usually meet on Monday.",
                q: "Day: _______ (No more than 1 word)",
                opts: ["on Monday", "Monday"],
                ans: 1, // index of correct
                why: "The limit is 1 word. 'Monday' is sufficient."
            },
            {
                audio: "The ticket costs $50.",
                q: "Price: _______ (No more than 1 word/number)",
                opts: ["$50", "for $50"],
                ans: 0,
                why: "'For' is unnecessary and wastes word count."
            },
            {
                audio: "We are located at the Main Station.",
                q: "Location: _______ (No more than 3 words)",
                opts: ["at the Main Station", "the Main Station"],
                ans: 1,
                why: "It fits the 3 word limit, but usually we omit 'at' in form filling."
            },
            {
                audio: "It starts at 5 pm.",
                q: "Time: _______",
                opts: ["5 pm", "at 5 pm"],
                ans: 0,
                why: "Just write the time. The preposition is implied."
            }
        ];

        let prepIdx = 0;

        function loadPrep() {
            const current = prepScenarios[prepIdx];
            document.getElementById('prep-audio').innerHTML = `<strong>Audio:</strong> "${current.audio}"`;
            document.getElementById('prep-q').innerText = `Question: ${current.q}`;
            document.getElementById('prep-btn-0').innerText = current.opts[0];
            document.getElementById('prep-btn-1').innerText = current.opts[1];
        }

        function checkPrep(choiceIdx) {
            const current = prepScenarios[prepIdx];
            const msg = document.getElementById('prep-msg');
            const btn = document.getElementById(`prep-btn-${choiceIdx}`);

            // Reset buttons first
            document.getElementById('prep-btn-0').style.backgroundColor = "white";
            document.getElementById('prep-btn-1').style.backgroundColor = "white";

            if(choiceIdx === current.ans) {
                btn.style.backgroundColor = "#dcfce7";
                msg.innerHTML = `<span style='color:#16a34a'>‚úÖ Correct! ${current.why}</span>`;
            } else {
                btn.style.backgroundColor = "#fee2e2";
                msg.innerHTML = `<span style='color:#dc2626'>‚ùå Incorrect. ${current.why}</span>`;
            }
        }

        function nextPrep() {
            prepIdx = (prepIdx + 1) % prepScenarios.length;
            loadPrep();
            document.getElementById('prep-msg').innerText = "";
            document.getElementById('prep-btn-0').style.backgroundColor = "white";
            document.getElementById('prep-btn-1').style.backgroundColor = "white";
        }

        // --- PREDICTION PRACTICE (Tab 3) ---
        const pred_questions = [
            { q: "Meeting time: _______", type: "Number/Time" },
            { q: "Meet at: _______ (Location)", type: "Place" },
            { q: "Call: _______", type: "Person's Name" }
        ];
        
        function checkPred(guess) {
            const feedback = document.getElementById('pred-feedback');
            const currentText = document.getElementById('pred-q').innerText;
            
            if(currentText.includes("Meeting time") && guess === "Number/Time") {
                feedback.innerHTML = "<span style='color:green'>Correct! Expect a number/time.</span>";
                setTimeout(() => {
                    document.getElementById('pred-q').innerText = "Location: _______ Room";
                    feedback.innerText = "";
                }, 1500);
            } else if (currentText.includes("Location") && guess === "Place") {
                 feedback.innerHTML = "<span style='color:green'>Correct! Expect a place name.</span>";
                 setTimeout(() => {
                    document.getElementById('pred-q').innerText = "Caller Name: _______";
                    feedback.innerText = "";
                }, 1500);
            } else if (currentText.includes("Caller Name") && guess === "Name") {
                 feedback.innerHTML = "<span style='color:green'>Correct! Expect a person's name.</span>";
                 setTimeout(() => {
                    document.getElementById('pred-q').innerText = "Meeting time: _______"; 
                    feedback.innerText = "";
                }, 1500);
            } else {
                feedback.innerHTML = "<span style='color:red'>Try again. Context matters!</span>";
            }
        }

        // --- ABBREVIATION GAME (Tab 3) ---
        const notePairs = [
            { id: 1, text: "uni", match: "University" },
            { id: 2, text: "lib", match: "Library" },
            { id: 3, text: "wk", match: "Week" },
            { id: 4, text: "bksp", match: "Bookshop" }
        ];
        
        let selectedNote = null;
        
        function initNoteGame() {
            const container = document.getElementById('noteGame');
            const items = [];
            notePairs.forEach(p => {
                items.push({ id: p.id, text: p.text });
                items.push({ id: p.id, text: p.match });
            });
            items.sort(() => Math.random() - 0.5);

            container.innerHTML = '';
            items.forEach((item) => {
                const div = document.createElement('div');
                div.className = 'note-item';
                div.innerText = item.text;
                div.dataset.id = item.id;
                div.onclick = () => handleNoteClick(div);
                container.appendChild(div);
            });
        }

        function handleNoteClick(el) {
            if(el.classList.contains('matched')) return;

            if(!selectedNote) {
                selectedNote = el;
                el.style.background = "#eff6ff";
                el.style.borderColor = "#3b82f6";
            } else {
                if(selectedNote.dataset.id === el.dataset.id && selectedNote !== el) {
                    selectedNote.classList.add('matched');
                    el.classList.add('matched');
                    document.getElementById('note-msg').innerText = "Match Found! ‚úÖ";
                } else {
                    selectedNote.style.background = "white";
                    selectedNote.style.borderColor = "#ddd";
                    document.getElementById('note-msg').innerText = "Try Again ‚ùå";
                }
                selectedNote = null;
            }
        }

        // --- DYNAMIC TRAP DETECTOR (Tab 4) ---
        const trapScenarios = [
            {
                audio: "Shall we meet at 7 o'clock? ... Oh sorry! How about half past seven?",
                q: "Meeting time?",
                opts: ["7:00", "7:30"],
                ans: 1
            },
            {
                audio: "The ticket normally costs $25, but for students it's $15.",
                q: "Cost for students?",
                opts: ["$25", "$15"],
                ans: 1
            },
            {
                audio: "We are moving office on the 14th of June... actually, looking at the calendar, it's the 15th.",
                q: "Moving date?",
                opts: ["14th June", "15th June"],
                ans: 1
            },
            {
                audio: "Go to Room 302. Ah, wait, that room is occupied. The meeting is in 304.",
                q: "Room Number?",
                opts: ["302", "304"],
                ans: 1
            }
        ];

        let trapIdx = 0;

        function loadTrap() {
            const current = trapScenarios[trapIdx];
            document.getElementById('trap-audio').innerHTML = `<strong>Audio:</strong> "${current.audio}"`;
            document.getElementById('trap-q').innerText = `Question: ${current.q}`;
            document.getElementById('trap-btn-0').innerText = current.opts[0];
            document.getElementById('trap-btn-1').innerText = current.opts[1];
        }

        function checkTrapDynamic(choiceIdx) {
            const current = trapScenarios[trapIdx];
            const msg = document.getElementById('trap-msg');
            const btn = document.getElementById(`trap-btn-${choiceIdx}`);
            const parent = btn.parentElement.nextElementSibling; // trap-msg div

            // Reset
            document.getElementById('trap-btn-0').style.backgroundColor = "white";
            document.getElementById('trap-btn-1').style.backgroundColor = "white";

            if(choiceIdx === current.ans) {
                btn.style.backgroundColor = "#dcfce7";
                msg.innerHTML = "<span style='color:#16a34a'>‚úÖ Correct! The speaker self-corrected.</span>";
            } else {
                btn.style.backgroundColor = "#fee2e2";
                msg.innerHTML = "<span style='color:#dc2626'>‚ùå Incorrect. That was the distracter (first mention).</span>";
            }
        }

        function nextTrap() {
            trapIdx = (trapIdx + 1) % trapScenarios.length;
            loadTrap();
            document.getElementById('trap-msg').innerText = "";
            document.getElementById('trap-btn-0').style.backgroundColor = "white";
            document.getElementById('trap-btn-1').style.backgroundColor = "white";
        }

        // --- EXACT MATCH CHALLENGE (Tab 4) ---
        const exactQuestions = [
            {
                audio: "Children must be accompanied by an adult at all times.",
                q: "No children are allowed without _______.",
                opts: ["an accompanied adult", "an adult"],
                ans: 1 // index of correct
            },
            {
                audio: "The assignment must be submitted to the tutor directly.",
                q: "Hand the work in to _______.",
                opts: ["a submitted tutor", "the tutor"],
                ans: 1
            },
            {
                audio: "Guests are required to wear formal attire.",
                q: "Guests must wear _______.",
                opts: ["formal attire", "required attire"],
                ans: 0
            },
            {
                audio: "The car needs to be washed by a professional.",
                q: "Job must be done by _______.",
                opts: ["a washed professional", "a professional"],
                ans: 1
            }
        ];
        
        let exactIdx = 0;

        function nextExact() {
            exactIdx = (exactIdx + 1) % exactQuestions.length;
            loadExact();
            document.getElementById('exact-msg').innerText = "";
            // Reset buttons
            document.getElementById('exact-btn-0').style.backgroundColor = "white";
            document.getElementById('exact-btn-1').style.backgroundColor = "white";
        }

        function loadExact() {
            const current = exactQuestions[exactIdx];
            document.getElementById('exact-audio').innerHTML = `<strong>Audio:</strong> "${current.audio}"`;
            document.getElementById('exact-q').innerText = `Question: ${current.q}`;
            document.getElementById('exact-btn-0').innerText = current.opts[0];
            document.getElementById('exact-btn-1').innerText = current.opts[1];
        }

        function checkExact(choiceIdx) {
            const current = exactQuestions[exactIdx];
            const msg = document.getElementById('exact-msg');
            const btn = document.getElementById(`exact-btn-${choiceIdx}`);

            // Reset
            document.getElementById('exact-btn-0').style.backgroundColor = "white";
            document.getElementById('exact-btn-1').style.backgroundColor = "white";

            if(choiceIdx === current.ans) {
                btn.style.backgroundColor = "#dcfce7";
                msg.innerHTML = "<span style='color:#16a34a'>‚úÖ Correct! Grammatically fits the gap.</span>";
            } else {
                btn.style.backgroundColor = "#fee2e2";
                msg.innerHTML = "<span style='color:#dc2626'>‚ùå Incorrect. Don't include words that don't fit!</span>";
            }
        }

        // Init functions
        initNoteGame();
        loadTrap();  // Load first trap
        loadExact(); // Load first exact match
        loadPrep();  // Load first preposition game

    </script>

</body>
</html>
